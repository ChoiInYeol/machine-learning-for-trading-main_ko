# 변동성 예측에서 통계 차익거래까지: 선형 시계열 모델

이 장에서는 시간을 명시적으로 표현하고 특정 간격이나 시차에서 관찰된 변수를 포함하는 동적 선형 모델을 구축합니다. 시계열 데이터의 주요 특징은 순차적 순서입니다. 단면 데이터의 경우처럼 개별 관찰의 무작위 샘플이 아니라 우리 데이터는 반복할 수 없는 확률론적 프로세스의 단일 구현입니다.

우리의 목표는 시계열이 미래에 어떻게 작동할지 예측하는 데 도움이 되는 **시계열의 체계적인 패턴**을 식별하는 것입니다. 보다 구체적으로, 우리는 출력의 과거 시퀀스에서 신호를 추출하고 선택적으로 출력의 미래 값을 예측하기 위해 동시 발생 또는 지연된 다른 입력 변수에서 신호를 추출하는 모델에 중점을 둡니다. 예를 들어, 과거 수익률과 벤치마크 또는 거시경제 변수의 과거 수익률을 결합하여 주식의 미래 수익률을 예측하려고 할 수 있습니다. 4부에서는 순환 신경망이나 컨벌루션 신경망과 같은 비선형 모델을 다루기 전에 선형 시계열 모델에 중점을 둡니다.

시계열 모델은 거래에 내재된 시간 차원을 고려할 때 매우 인기가 있습니다. 주요 애플리케이션에는 **자산 수익률 및 변동성 예측**과 자산 가격 계열의 동조성 식별이 포함됩니다. 점점 더 광범위한 연결된 장치 배열이 잠재적인 신호 내용과 함께 정기적인 측정값을 수집함에 따라 시계열 데이터가 더욱 널리 보급될 가능성이 높습니다.

먼저 시계열 특성을 진단하고 잠재적 패턴을 포착하는 기능을 추출하는 도구를 소개합니다. 그런 다음 일변량 및 다변량 시계열 모델을 도입하고 이를 거시 데이터 및 변동성 패턴 예측에 적용합니다. 우리는 **공통합** 개념과 이를 적용하여 **쌍 거래 전략**을 개발하는 방법으로 결론을 내립니다.

## 콘텐츠

1. __자리표시자_0__
    * __자리표시자_1__
    * __자리표시자_2__
    * __자리표시자_3__
    * __자리표시자_4__
    * __자리표시자_5__
    * __자리표시자_6__
    * __자리표시자_7__
    * __자리표시자_8__
2. __자리표시자_9__
    * __자리표시자_10__
    * __자리표시자_11__
    * __자리표시자_12__
    * __자리표시자_13__
    * __자리표시자_14__
    * __자리표시자_15__
    * __자리표시자_16__
    * __자리표시자_17__
3. __자리표시자_18__
    * __자리표시자_19__
    * __자리표시자_20__
    * __자리표시자_21__
4. __자리표시자_22__
    * __자리표시자_23__
    * __자리표시자_24__
    * __자리표시자_25__
        - __자리표시자_26__
        - __자리표시자_27__
    * __자리표시자_28__

## 진단 및 특징 추출 도구

이 섹션에 있는 대부분의 예는 [2장, 시장 및 기본 데이터](../02_market_and_fundamental_data)에서 소개한 pandas 데이터 리더를 사용하여 액세스할 수 있는 연방 준비 은행에서 제공한 데이터를 사용합니다.

### 시계열 패턴을 분해하는 방법

시계열 데이터에는 일반적으로 기본 패턴 범주를 나타내는 여러 구성 요소로 분해될 수 있는 다양한 패턴이 혼합되어 있습니다. 특히 시계열은 체계적 구성요소 추세, 계절성과 주기, 비체계적 노이즈로 구성되는 경우가 많습니다. 이러한 구성 요소는 특히 변동이 계열 수준에 의존하지 않는 경우 가법 선형 모델이나 비선형 승법 모델에서 결합될 수 있습니다.

- `pandas` 시계열 및 날짜 기능 [문서](https://pandas.pydata.org/pandas-docs/stable/timeseries.html)
- __자리표시자_31__

### 롤링 윈도우 통계 및 이동 평균

pandas 라이브러리에는 롤링 창, 지수 가중치 창, 확장 창을 포함하여 다양한 창 유형을 정의하는 매우 유연한 기능이 포함되어 있습니다.

- `pandas` 창 기능 [문서](https://pandas.pydata.org/pandas-docs/stable/computation.html#window-functions)

### 자기상관을 측정하는 방법

자기 상관(계열 상관이라고도 함)은 상관 개념을 시계열 컨텍스트에 적용합니다. 상관 계수가 두 변수 사이의 선형 관계의 강도를 측정하는 것처럼 자기 상관 계수는 다음으로 구분된 시계열 값 간의 선형 관계의 범위를 측정합니다. 주어진 지연.

자기상관을 측정하기 위해 다음 도구를 제시합니다.
- 자기상관함수(ACF)
- 부분 자기상관 함수(PACF)
- 시차 수에 대한 ACF 또는 PACF 플롯인 상관도.

### 정상성을 진단하고 달성하는 방법

고정 시계열의 평균, 분산, 자기상관과 같은 통계적 속성은 기간과 무관합니다. 즉, 시간이 지나도 변하지 않습니다. 따라서 정상성은 시계열에 추세나 계절 효과가 없으며 평균이나 표준 편차와 같은 기술 통계가 여러 롤링 창에 대해 계산될 때 일정하거나 시간이 지나도 크게 변하지 않는다는 것을 의미합니다.

### 시계열 변환을 적용하는 방법

선형 시계열 모델의 정상성 가정을 충족하려면 원래 시계열을 여러 단계로 변환해야 합니다. 일반적인 변환에는 지수 증가 패턴을 선형 추세로 변환하고 분산 또는 차이를 안정화하기 위한 (자연) 로그 적용이 포함됩니다.

### 단위뿌리를 진단하고 해결하는 방법

단위근은 시계열을 고정시키는 변환을 결정하는 데 특별한 문제를 제기합니다. 실제로 이자율이나 자산 가격의 시계열은 고정되지 않는 경우가 많습니다. 예를 들어 시계열이 되돌아가는 가격 수준이 존재하지 않기 때문입니다. Non-Stationary 시리즈의 가장 두드러진 예는 랜덤 워크(Random Walk)입니다.

단위근 비정상 계열의 정의 특성은 긴 메모리입니다. 현재 값은 과거 교란의 합이므로 대규모 혁신은 평균 회귀 고정 계열보다 훨씬 오랫동안 지속됩니다. 올바른 변환, 특히 차분을 위한 적절한 수와 시차를 식별하는 것이 항상 명확한 것은 아닙니다. 우리는 프로세스를 안내하기 위해 몇 가지 경험적 방법을 제시합니다.

통계적 단위근 테스트는 (추가) 차분이 필요한지 여부를 객관적으로 결정하는 일반적인 방법입니다. 이는 차분이 필요한지 여부를 결정하기 위해 고안된 정상성에 대한 통계적 가설 검정입니다.

### 코드 예: 시계열 데이터 작업

- 노트북 [tsa_and_stationarity](01_tsa_and_stationarity.ipynb)은 이 섹션에서 논의된 개념을 보여줍니다.

### 자원

- __자리표시자_34__
- __자리 표시자_35__
- `statsmodels` 시계열 분석 [문서](https://www.statsmodels.org/dev/tsa.html)

## 일변량 시계열 모델

일변량 시계열 모델은 관심 시점의 시계열 값을 계열의 시차 값과 과거 교란 항의 선형 조합과 연관시킵니다.

지수평활 모델은 데이터의 추세와 계절성에 대한 설명을 기반으로 하는 반면, ARIMA 모델은 데이터의 자기상관을 설명하는 것을 목표로 합니다. ARIMA(p, d, q) 모델에는 정상성이 필요하며 두 가지 구성 요소를 활용합니다.
- 시계열의 p-지연 값으로 구성된 자기회귀(AR) 항
- q 지연 교란을 포함하는 이동 평균(MA) 항

### 자기회귀 모델을 구축하는 방법

p차 AR 모델은 서로 다른 시차에서 시계열 값 간의 선형 의존성을 포착하는 것을 목표로 합니다. 이는 결과의 시차 값에 대한 다중 선형 회귀와 매우 유사합니다.

### 이동 평균 모델을 구축하는 방법

q차 MA 모델은 회귀 유사 모델에서 시계열의 시차 값 대신 q 과거 교란을 사용합니다. 백색잡음 교란 값을 관찰하지 않기 때문에 MA(q)는 지금까지 본 것과 같은 회귀 모델이 아닙니다. MA(q) 모델은 최소 제곱을 사용하는 대신 최대 우도(MLE)를 사용하여 추정됩니다.

### ARIMA 모델 및 확장을 구축하는 방법

자기회귀 통합 이동 평균 ARIMA(p, d, q) 모델은 AR(p) 및 MA(q) 프로세스를 결합하여 이러한 빌딩 블록의 상보성을 활용하고 보다 컴팩트한 형식을 사용하고 매개변수 수를 줄여 모델 개발을 단순화합니다. 결과적으로 과적합 위험이 줄어듭니다.

- statsmodels 상태공간 모델 [문서](https://www.statsmodels.org/dev/statespace.html)

### 코드 예: ARIMA 및 SARIMAX 모델을 사용하여 거시적 기본 사항 예측

우리는 1988~2017년 기간의 산업 생산 시계열에 대한 월별 데이터를 위한 SARIMAX 모델을 구축할 것입니다. 구현 세부정보는 노트북 [arima_models](02_arima_models.ipynb)을 참조하세요.

### 시계열 모델을 사용하여 변동성을 예측하는 방법

단변량 시계열 모델의 특히 중요한 적용 분야는 변동성 예측입니다. 금융 시계열의 변동성은 일반적으로 시간이 지남에 따라 일정하지 않고 변동성이 함께 모여 변화합니다. 분산의 변화는 기존 ARIMA 모델을 사용한 시계열 예측에 어려움을 야기합니다.

### 변동성 예측 모델을 구축하는 방법

자산수익률 시리즈에 대한 변동성 모델 개발은 다음 네 단계로 구성됩니다.
1. ACF와 PACF에 의해 밝혀진 직렬 의존성을 기반으로 금융 시계열에 대한 ARMA 시계열 모델을 구축합니다.
2. ARCH/GARCH 효과에 대한 모델의 잔차를 테스트하고 다시 제곱 잔차 계열에 대한 ACF 및 PACF를 사용합니다.
3. 계열 상관 효과가 유의한 경우 변동성 모델을 지정하고 평균 및 변동성 방정식을 공동으로 추정합니다.
4. 장착된 모델을 주의 깊게 확인하고 필요한 경우 다듬습니다.

### 코드 예시: 변동성 예측

[Arch_garch_models](03_arch_garch_models.ipynb) 노트북은 ARCH 라이브러리를 사용하여 NASDAQ 데이터를 사용한 변동성 예측을 위한 시계열 모델을 추정하는 방법을 보여줍니다.

### 자원

- NYU 스턴 [VLAB](https://vlab.stern.nyu.edu/)
- ARCH 도서관
    - __자리표시자_41__ 
    - __자리표시자_42__

## 다변량 시계열 모델

다변량 시계열 모델은 여러 시계열의 동적 특성을 동시에 캡처하고 이러한 시계열 간의 종속성을 활용하여 보다 안정적인 예측을 수행하도록 설계되었습니다.

ARMA 접근법과 같은 일변량 시계열 모델은 목표 변수와 그 시차 값 또는 시차 교란과 ARMAX 사례의 외생 계열 사이의 통계적 관계로 제한됩니다. 대조적으로, 다변량 시계열 모델은 다른 시계열의 시차 값이 목표에 영향을 미치는 것을 허용합니다. 이 효과는 모든 계열에 적용되므로 복잡한 상호 작용이 발생합니다.

잠재적으로 더 나은 예측 외에도 다변량 시계열은 교차 계열 종속성에 대한 통찰력을 얻는 데 사용됩니다. 예를 들어, 경제학에서는 이자율과 같은 하나의 변수에 대한 정책 변경이 다양한 범위에 걸쳐 다른 변수에 어떻게 영향을 미칠 수 있는지 이해하기 위해 다변량 시계열을 사용합니다.

- __자리표시자_43__

### 벡터 자기회귀(VAR) 모델

벡터 자기회귀 VAR(p) 모델은 각각 모든 k 계열의 p 시차 값을 포함하는 k 방정식 시스템을 생성하여 AR(p) 모델을 k 계열로 확장합니다.

VAR(p) 모델에는 또한 정상성이 필요하므로 단변량 시계열 모델링의 초기 단계가 이어집니다. 먼저 계열을 탐색하고 필요한 변환을 결정한 다음 증강된 Dickey-Fuller 테스트를 적용하여 각 계열에 대해 정상성 기준이 충족되는지 확인하고 그렇지 않으면 추가 변환을 적용합니다. 초기 정보에 대한 OLS 조건부 또는 정규 분포 오류와 동일하지만 그렇지 않은 MLE를 사용하여 추정할 수 있습니다.

k 계열 중 일부 또는 전부가 단위근 비고정형인 경우 공적분될 수 있습니다(다음 섹션 참조). 단위근 개념을 여러 시계열로 확장하면 두 개 이상의 계열의 선형 조합이 고정되어 평균 회귀를 의미합니다.

### 코드 예: 거시적 펀더멘털 예측을 위해 VAR 모델을 사용하는 방법

[vector_autoregressive_model](04_vector_autoregressive_model.ipynb) 노트북은 `statsmodels`을 사용하여 매크로 기본 시계열에 대한 VAR 모델을 추정하는 방법을 보여줍니다.

### 자원

- `statsmodels` 벡터 자동 회귀 [문서](https://www.statsmodels.org/dev/vector_ar.html)
- [통계 모델을 사용한 Python의 시계열 분석](https://conference.scipy.org/proceedings/scipy2011/pdfs/statsmodels.pdf), Wes McKinney, Josef Perktold, Skipper Seabold, SciPY 컨퍼런스 2011

## 공적분 – 공통 추세가 있는 시계열

통합 다변량 계열의 개념은 공정의 모든 구성 요소 계열이 개별적으로 통합될 수 있지만 새로운 고정 계열을 생성하는 계열의 하나 이상의 선형 조합이 존재한다는 의미에서 공정이 공동으로 통합되지 않는다는 사실로 인해 복잡해집니다. .

즉, 두 개의 공적분 계열의 조합은 이 선형 조합이 되돌아가는 안정적인 평균을 갖습니다. 이러한 특성을 지닌 다변량 계열을 공적분 계열이라고 합니다. 이는 개별 계열이 더 높은 차수로 통합되고 선형 조합이 전체 통합 차수를 줄이는 경우에도 적용됩니다.

우리는 공적분 테스트에 대한 두 가지 주요 접근 방식을 보여줍니다.
- Engle-Granger 2단계 방법
- 요한센 절차

### 쌍 거래: 공적분을 이용한 통계적 차익거래

통계적 차익거래는 시장 중립성 수준을 유지하면서 자산의 상대적인 잘못된 가격 책정을 활용하기 위해 일부 통계적 모델이나 방법을 사용하는 전략을 의미합니다.

쌍 거래는 적어도 80년대 중반부터 알고리즘 거래자들이 사용해 온 개념적으로 간단한 전략입니다(Gatev, Goetzmann, Rouwenhorst 2006). 목표는 역사적으로 가격이 함께 움직인 두 자산을 찾고, 스프레드(가격 간의 차이)를 추적하고, 일단 스프레드가 확대되면 공통 추세 아래로 떨어진 패자를 매수하고 승자에게 매도하는 것입니다. 관계가 지속되면 가격이 수렴되고 포지션이 종료됨에 따라 롱 및/또는 숏 레그가 이익을 제공하게 됩니다.

이 접근 방식은 여러 증권으로 바구니를 형성하고 하나의 자산을 두 바구니로 구성된 바구니와 거래함으로써 다변량 맥락으로 확장됩니다.

실제로 이 전략에는 두 단계가 필요합니다. 
1. 형성 단계: 장기적인 평균 회귀 관계를 갖는 증권을 식별합니다. 이상적으로 스프레드는 일반적인 추세로 안정적으로 되돌아가면서 빈번한 수익성 있는 거래를 허용할 수 있도록 높은 분산을 가져야 합니다.
2. 거래 단계: 가격 변동으로 인해 스프레드가 분기 및 수렴되므로 진입 및 퇴출 거래 규칙이 시작됩니다.

지난 몇 년 동안 여러 자산 클래스에 걸쳐 이 분야에 대한 점점 더 활발한 연구를 통해 형성 및 거래 단계에 대한 여러 가지 접근 방식이 나타났습니다. 다음 하위 섹션에서는 예제 애플리케이션을 살펴보기 전에 주요 차이점을 간략하게 설명합니다.

### 향후 자산 선택 및 거래에 대한 대체 접근 방식

최근 쌍 거래 전략에 대한 포괄적인 조사([통계 차익 거래 쌍 거래 전략: 검토
및 전망](https://www.iwf.rw.fau.de/files/2016/03/09-2015.pdf))에서 Krauss(2017)는 4가지 방법론과 ML 기반 예측을 포함한 여러 가지 최신 접근 방식을 식별합니다.

- **거리** 접근 방식: 가장 오래되고 가장 많이 연구된 방법은 상관관계와 같은 거리 지표를 사용하여 후보 쌍을 식별하고 볼린저 밴드와 같은 비모수적 임계값을 사용하여 진입 및 청산 거래를 시작합니다. 계산의 단순성 덕분에 Gatev 등 이후 오랜 기간 동안 시장과 자산 클래스 전반에 걸쳐 수익성이 입증된 대규모 애플리케이션을 사용할 수 있습니다. (2006). 그러나 최근에는 성능이 저하되었습니다.
- **공적분** 접근 방식: 이전에 설명한 대로 이 접근 방식은 두 개 이상의 변수 간의 장기적인 관계에 대한 계량 경제학 모델에 의존하며 단순한 거리 측정보다 더 많은 신뢰성을 보장하는 통계 테스트를 허용합니다. 이 범주의 예는 Engle-Granger 및 Johansen 절차를 사용하여 유가 증권 쌍 및 바스켓을 식별할 뿐만 아니라 개념을 포착하는 것을 목표로 하는 간단한 경험적 방법을 사용합니다(Vidyamurthy 2004). 거래 규칙은 종종 거리 측정법에 사용되는 단순 임계값과 유사합니다.
- **시계열** 접근 방식: 거래 단계에 초점을 맞춘 이 카테고리의 전략은 스프레드를 평균 회귀 확률론적 과정으로 모델링하고 이에 따라 진입 및 퇴출 규칙을 최적화하는 것을 목표로 합니다(Elliott, Hoek, and Malcolm 2005) . 유망한 쌍이 이미 식별되었다고 가정합니다.
- **확률적 통제** 접근법: 시계열 접근법과 유사하게, 목표는 확률적 통제 이론을 사용하여 거래 규칙을 최적화하여 최적의 포트폴리오에 도달하는 가치와 정책 기능을 찾는 것입니다(Liu 및 Timmermann 2013). 우리는 21장 강화 학습에서 이러한 유형의 접근 방식을 다룰 것입니다.
- **다른 접근 방식**: 주성분 분석(13장, 비지도 학습 참조)과 같은 비지도 학습과 코퓰러(Patton 2012)와 같은 통계 모델을 기반으로 한 쌍 식별 외에도 기계 학습이 최근 대중화되었습니다. 상대 가격 또는 수익률 예측(Huck 2019). 이 목적으로 사용할 수 있는 여러 ML 알고리즘을 다루고 다음 장에서는 해당 다변량 쌍 거래 전략을 설명합니다.

### 코드 예: 실제 쌍 거래

**거리 접근법**은 (정규화된) 자산 가격 또는 그 수익의 상관관계를 사용하여 쌍을 식별하며 간단하고 공적분 테스트보다 계산 집약도가 훨씬 낮습니다. 
- 노트북 [공동 통합_테스트](05_cointegration_tests.ipynb)은 4년간의 일일 데이터가 포함된 ~150개 주식 샘플에 대해 이를 보여줍니다. ETF 수익률과의 상관관계를 계산하는 데 ~30ms가 걸리는 반면, 일련의 공적분 테스트(통계 모델 사용)의 경우 18초가 걸립니다. 600배 느립니다.

잠재적인 쌍의 수는 양쪽에서 고려해야 할 후보 수의 곱이므로 속도 이점은 특히 중요합니다. 따라서 100개 주식과 100개 ETF의 조합을 평가하려면 10,000번의 테스트를 비교해야 합니다(다중 테스트의 어려움에 대해 논의하겠습니다). 아래는 편견).

반면, 거리 측정법은 가장 수익성이 높은 쌍을 반드시 선택하는 것은 아닙니다. 완벽한 동조를 위해 상관관계가 최대화되어 실제 거래 기회가 제거됩니다. 실증적 연구에 따르면 공적분 쌍의 가격 스프레드 변동성은 거리 쌍의 가격 스프레드 변동성의 거의 두 배에 달합니다(Huck and Afawubo 2015).

계산 비용과 결과 쌍의 품질 간의 균형을 맞추기 위해 Krauss(2017)는 문헌 검토를 기반으로 두 가지 접근 방식을 결합하는 절차를 권장합니다.
1. 후보 수를 줄이기 위해 드리프트가 거의 없는 안정적인 스프레드를 가진 쌍을 선택합니다.
2. 공적분을 위해 분산 분산이 가장 높은 나머지 쌍을 테스트합니다.

이 프로세스의 목표는 발산 위험이 낮은 공적분 쌍을 선택하는 동시에 변동성이 더 높은 스프레드를 보장하여 더 높은 수익 기회를 창출하는 것입니다.

다수의 테스트는 6장, 기계 학습 작업 흐름에서 설명한 대로 데이터 스누핑 편향을 도입합니다. 다중 테스트는 공적분이 없다는 귀무 가설을 실수로 기각하는 거짓 긍정의 수를 증가시킬 가능성이 높습니다. 수익성 있는 거래에는 통계적 유의성이 필요하지 않을 수 있지만(Chan 2008), 상품 쌍에 대한 연구(Cummins 및 Bucca 2012)에 따르면 Romano 및 Wolf(2010)에 따라 테스트 성능을 향상시키기 위해 가족별 오류율을 제어하면 다음과 같은 결과가 발생할 수 있습니다. 더 나은 성능.

#### 공적분 쌍을 식별하기 위한 거리 기반 휴리스틱 계산

- 노트북 [공동 통합_테스트](05_cointegration_tests.ipynb)에서는 자산 가격 변동 정도에 대한 다양한 휴리스틱이 공적분 테스트 결과에 대해 얼마나 예측되는지 자세히 살펴봅니다. 예제 코드는 Stooq에서 제공한 2010년부터 2019년까지의 일일 데이터와 함께 NYSE 및 NASDAQ에서 거래되는 172개의 주식과 138개의 ETF 샘플을 사용합니다.

해당 증권은 해당 클래스에서 표본 기간 동안 가장 큰 평균 달러 거래량을 나타냅니다. 상관관계가 높은 고정 자산이 제거되었습니다. 데이터를 얻는 방법에 대한 지침은 다운로드하려면 GitHub 저장소의 데이터 폴더에 있는 [create_datasets](../data/create_datasets.ipynb) 노트북을 참조하고, 관련 코드와 추가 사전 처리 및 탐색 세부 정보는 cointegration_tests 노트북을 참조하세요.

#### 공적분 테스트 사전 계산

노트북 [Statistics_arbitrage_with_cointegrated_pairs](06_statistical_arbitrage_with_cointegrated_pairs.ipynb)은 주식 및 ETF 샘플과 2017~2019 기간에 대한 공적분을 기반으로 통계적 차익거래 전략을 구현합니다.

프로세스의 계산 강도를 고려하여 이러한 신호를 기반으로 전략을 백테스트하기 전에 먼저 모든 후보 쌍에 대한 공적분 테스트와 결과 거래 신호를 생성하고 저장합니다.

### 자원

- Quantopian은 쌍 거래에 대한 다양한 리소스를 제공합니다:
    - __자리표시자_52__
    - __자리표시자_53__
    - __자리표시자_54__
    - __자리표시자_55__
- 추가 블로그 게시물은 다음과 같습니다.
    - __자리표시자_56__
    - __자리표시자_57__
    - [교미](https://twiecki.io/blog/2018/05/03/copulas/) 작성자: Thomas Wiecki