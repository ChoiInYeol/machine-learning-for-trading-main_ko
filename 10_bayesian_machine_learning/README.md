# 베이지안 ML: 경기 침체 예측에서 동적 쌍 거래까지

이 장에서는 기계 학습(ML)에 대한 베이지안 접근 방식을 소개하고 거래 전략을 개발하고 평가할 때 불확실성에 대한 베이지안 접근 방식이 어떻게 가치를 더하는지 소개합니다.

베이지안 통계를 사용하면 미래 사건에 대한 불확실성을 수량화하고 새로운 정보가 도착함에 따라 원칙적인 방식으로 추정치를 개선할 수 있습니다. 이러한 역동적인 접근 방식은 금융 시장의 진화하는 특성에 잘 적응합니다. 관련 데이터가 적고 사전 지식이나 가정을 체계적으로 통합하는 방법이 필요할 때 특히 유용합니다.

우리는 기계 학습에 대한 베이지안 접근 방식을 통해 통계 지표, 매개변수 추정 및 예측과 관련된 불확실성에 대한 더 풍부한 통찰력을 얻을 수 있음을 알게 될 것입니다. 적용 범위는 더욱 세분화된 위험 관리부터 시장 환경의 변화를 통합하는 예측 모델의 동적 업데이트까지 다양합니다. 자산 배분에 대한 Black-Litterman 접근 방식([5장 포트폴리오 최적화 및 성과 평가](../05_strategy_evaluation) 참조)은 베이지안 모델로 해석될 수 있습니다. 이는 각 자산의 변동성, 자산 간 상관 관계, 그리고 각 예측에 대한 신뢰도.

## 콘텐츠

1. __자리표시자_1__
        - __자리표시자_2__
    * __자리표시자_3__
    * __자리표시자_4__
        - __자리 표시자_5__
        - __자리표시자_6__
    * __자리표시자_7__
2. __자리표시자_8__
    * __자리표시자_9__
    * __자리표시자_10__
    * __자리표시자_11__
    * __자리표시자_12__
        - __자리표시자_13__
3. __자리표시자_14__
    * __자리표시자_15__
    * __자리표시자_16__
    * __자리표시자_17__
4. __자리표시자_18__
    * __자리표시자_19__
    * __자리표시자_20__

## 베이지안 기계 학습의 작동 방식

고전 통계는 확률을 장기적으로, 즉 많은 수의 시행을 관찰한 후 사건의 상대적 빈도로 해석하기 때문에 빈도주의적 접근 방식을 따른다고 합니다. 확률의 맥락에서 이벤트는 두 개의 주사위 굴림에서 6개의 동일한 결과 또는 특정 날짜에 자산 가격이 10% 이상 하락하는 등 실험의 하나 이상의 기본 결과의 조합입니다.

이와 대조적으로 베이지안 통계에서는 확률을 사건 발생에 대한 신뢰도 또는 믿음의 척도로 간주합니다. 따라서 베이지안 관점은 빈도주의적 해석보다 주관적인 견해와 의견 차이가 있을 여지가 더 많습니다. 이러한 차이는 장기적인 빈도에 대한 객관적인 측정에 도달할 만큼 자주 발생하지 않는 사건의 경우 가장 두드러집니다.

다르게 말하면, 빈도주의 통계에서는 데이터가 모집단의 무작위 표본이라고 가정하고 데이터를 생성한 고정 매개변수를 식별하는 것을 목표로 합니다. 베이지안 통계는 데이터를 주어진 것으로 간주하고 매개변수를 데이터에서 추론할 수 있는 분포를 갖는 확률 변수로 간주합니다. 결과적으로 빈도주의적 접근 방식에는 적어도 추정할 매개변수만큼 많은 데이터 포인트가 필요합니다. 반면 베이지안 접근 방식은 더 작은 데이터 세트와 호환되며 한 번에 하나의 샘플에서 온라인 학습에 매우 적합합니다.

베이지안 관점은 적어도 중요한 측면에서 드물거나 독특한 많은 실제 사건에 매우 유용합니다. 예를 들어 다음 선거 결과나 시장이 3개월 이내에 붕괴할지 여부에 대한 질문 등이 있습니다. 각각의 경우 관련 역사적 데이터는 물론 사건이 다가옴에 따라 펼쳐지는 독특한 상황도 있습니다.

먼저 이전 가정과 새로운 경험적 증거를 결합하여 신념 업데이트의 개념을 구체화하고 결과 매개변수 추정치를 빈도주의 대응과 비교하는 베이즈 정리를 소개합니다. 그런 다음 베이지안 통계적 추론에 대한 두 가지 접근법, 즉 잠재의 사후 분포에 대한 통찰력을 생성하는 공액 사전 추론과 근사 추론, 즉 기대값과 같은 관찰되지 않은 매개변수를 보여줍니다.

1. 켤레 사전확률은 솔루션을 정확하게 계산할 수 있는 폐쇄형 솔루션을 제공하여 업데이트 프로세스를 촉진합니다. 그러나 이러한 정확하고 분석적인 방법이 항상 이용 가능한 것은 아닙니다.
2. 근사 추론은 가정과 데이터를 결합하여 얻은 분포를 시뮬레이션하고 이 분포의 샘플을 사용하여 통계적 통찰력을 계산합니다.

#### 참고자료

- __자리표시자_21__
- __자리표시자_22__
- __자리표시자_23__

### 경험적 증거로부터 가정을 업데이트하는 방법

250여 년 전에 Thomas Bayes 목사가 제시한 정리는 John Maynard Keynes의 명언 "사실이 바뀌면 마음이 바뀐다"에 포착된 것처럼 관련 있는 새로운 정보가 도착할 때 확률이나 믿음이 어떻게 변해야 하는지를 규정하기 위해 기본 확률 이론을 사용합니다. 무엇을 하시나요?”

- __자리표시자_24__
- [연속 사전확률을 사용한 베이지안 업데이트](https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading13a.pdf), MIT 오픈 코스웨어, 18.05 확률 및 통계 소개

### 정확한 추론: 사후 추정의 최대화

분모의 증거 항을 계산하는 것이 매우 어렵기 때문에 사후 확률을 정확하게 계산하기 위한 베이즈 규칙의 실제 적용은 매우 제한적입니다.

#### 규모를 잘 유지하는 방법: 공액 우선 순위
사전 분포는 결과 사후 분포가 다른 매개변수를 제외하고 사전 분포와 동일한 유형의 분포인 경우 우도와 관련하여 켤레입니다. 사전 가능성과 우도의 결합은 업데이트 프로세스를 용이하게 하고 사후를 근사화하기 위해 수치적 방법을 사용할 필요가 없는 사후에 대한 폐쇄형 솔루션을 의미합니다.

#### 코드 예: 자산 가격 변동 가능성을 동적으로 추정하는 방법

노트북 [update_conjugate_priors](01_updating_conjugate_priors.ipynb)은 S&P 500 샘플의 가격 변동 추정치를 업데이트하기 전에 공액을 사용하는 방법을 보여줍니다.

### 결정론적 및 확률론적 근사 추론

실제 관련성이 있는 대부분의 모델의 경우 분석적으로 정확한 사후 분포를 도출하고 잠재 매개변수에 대한 기대값을 계산하는 것이 불가능합니다.

일부 응용 분야에서는 관찰되지 않은 매개변수에 대한 사후 분포가
관심을 끌 것입니다. 대부분의 경우 기대치를 평가하는 것이 주로 필요합니다. 예측을 하기 위해. 이러한 상황에서는 대략적인 추론에 의존할 수 있습니다.
- MCMC(Markov Chain Monte Carlo) 샘플링을 기반으로 하는 **확률적 기법**은 여러 영역에서 베이지안 방법의 사용을 대중화했습니다. 그들은 일반적으로 정확한 결과로 수렴하는 속성을 가지고 있습니다. 실제로 샘플링 방법은 계산이 까다로울 수 있으며 소규모 문제로 제한되는 경우가 많습니다. 
    - [해밀턴 몬테카를로의 개념적 소개](https://arxiv.org/pdf/1701.02434.pdf), 마이클 베탄쿠르, 2018
    - [유턴 없는 샘플러: 해밀턴 몬테카를로에서 경로 길이를 적응적으로 설정](https://arxiv.org/abs/1111.4246), 매튜 D. 호프만, 앤드류 겔먼, 2011
    - __자리표시자_29__

- 변이 추론 또는 변이 베이즈라고 불리는 **결정론적 방법**은 사후 분포에 대한 분석적 근사를 기반으로 하며 대규모 애플리케이션에 맞게 확장할 수 있습니다. 그들은 예를 들어 사후 인수분해가 특정 방식으로 이루어지거나 가우스와 같은 특정 매개변수 형식을 갖는다는 가정을 단순화합니다. 따라서 정확한 결과를 생성하지 않으며 샘플링 방법을 보완하는 데 사용할 수 있습니다.
    - [변이 추론: 통계학자를 위한 검토](https://arxiv.org/pdf/1601.00670.pdf), David Blei 외, 2018

## PyMC3를 사용한 확률적 프로그래밍

확률 프로그래밍은 복잡한 모델을 설계, 인코딩, 자동 추정 및 평가할 수 있도록 확률 분포를 설명하고 맞추는 언어를 제공합니다. 베이지안 추론과 추론의 개념적으로 보다 직접적이고 직관적인 측면에 집중할 수 있도록 일부 계산 및 분석적 복잡성을 추상화하는 것을 목표로 합니다.
Uber 오픈 소스 Pyro(PyTorch 기반)와 Google이 최근 TensorFlow에 확률 모듈을 추가한 이후 새로운 언어가 등장하면서 이 분야는 매우 역동적이 되었습니다.

### Theano를 사용한 베이지안 ML

- [PyMC3](https://docs.pymc.io/)은 PyMC2(2012년 출시)에서 사용되는 Metropolis-Hastings 샘플러에 Hamiltonian MC 방법을 추가하기 위해 2017년 1월에 출시되었습니다. PyMC3는 동적 C 컴파일 및 자동 차별화를 위한 계산 백엔드로 [테아노](http://www.deeplearning.net/software/theano/)를 사용합니다. Theano는 TensorFlow에 영감을 준 Yoshua Bengio의 MILA(Montreal Institute for Learning Algorithms)에서 개발된 행렬 중심의 GPU 지원 최적화 라이브러리입니다. MILA는 최근 최신 딥러닝 라이브러리의 성공으로 인해 Theano 추가 개발을 중단했습니다(자세한 내용은 16장 참조). 
- 2019년에 계획된 [PyMC4](https://github.com/pymc-devs/pymc4)은 대신 TensorFlow를 사용할 예정이며 API에 미치는 영향은 제한적일 것입니다.

### PyMC3 작업 흐름

PyMC3은 통계학자가 모델을 설명하는 방식을 반영하는 직관적이고 읽기 쉬우면서도 강력한 구문을 목표로 합니다. 모델링 프로세스는 일반적으로 다음 세 단계를 따릅니다.
1) 다음을 정의하여 확률 모델을 인코딩합니다. 
    1) 잠재변수에 대한 지식과 불확실성을 정량화하는 사전분포
    2) 관찰된 데이터에 대한 매개변수를 조건화하는 우도 함수
2) 이전 섹션에서 설명한 옵션 중 하나를 사용하여 후방을 분석합니다.
    1) MAP 추론을 이용하여 점추정값 구하기
    2) MCMC 방법을 이용한 후방 검체
    3) 변형 베이즈를 사용하여 후방을 근사화합니다.
3) 다양한 진단 도구를 사용하여 모델을 확인하십시오.
4) 예측 생성

- __자리표시자_34__
- [PyMC를 사용한 Python의 확률적 프로그래밍](https://arxiv.org/abs/1507.08050), Salvatier 외 2015
- [Theano: 수학 표현식의 빠른 계산을 위한 Python 프레임워크](https://pdfs.semanticscholar.org/6b57/0069f14c7588e066f7138e1f21af59d62e61.pdf), Al-Rfou 외, 2016
- __자리표시자_37__
- __자리표시자_38__
- [GitHub](https://github.com/pymc-devs/pymc4)의 PyMC 4(설계 가이드 및 사용 예시 포함)

### 코드 예: PyMC3를 사용한 경기 침체 예측

노트북 [pymc3_workflow](02_pymc3_workflow.ipynb)은 경기 침체 예측을 모델링하기 위해 간단한 로지스틱 회귀를 사용하여 PyMC3 작업 흐름의 다양한 측면을 보여줍니다.

### 데이터: 주요 ​​경기 침체 지표

우리는 워크플로우에 집중할 수 있도록 작고 간단한 데이터세트를 사용할 것입니다. 우리는 연방준비은행의 경제 데이터(FRED) 서비스(2장 참조)를 사용하여 미국 경제 연구국(National Bureau of Economic Research)에서 정의한 미국 경기 침체 날짜를 다운로드합니다. 우리는 또한 경기 침체의 시작을 예측하는 데 일반적으로 사용되며(Kelley 2019) FRED를 통해 사용할 수 있는 네 가지 변수, 즉 다음을 제공합니다.
- 국채수익률곡선의 장기 스프레드는 10년물과 3개월물 국채수익률의 차이로 정의됩니다.
- 미시간대학교 소비자심리지수
- 국가재정상태지수(NFCI) 및
- NFCI 비금융 레버리지 하위지수입니다.

#### 모델 정의: 베이지안 로지스틱 회귀

[선형 모델](../07_linear_models)에서 설명한 대로 로지스틱 회귀는 모델이 확률을 생성하도록 시그모이드 함수를 통해 매개되는 특성 집합과 이진 결과 간의 선형 관계를 추정합니다. 빈도주의적 접근법은 데이터 포인트가 포지티브 클래스에 속할 확률에 대한 각 특징의 영향을 측정하는 매개변수에 대한 점 추정치를 도출했으며, 매개변수 분포에 대한 가정을 기반으로 한 신뢰 구간을 사용했습니다.

이와 대조적으로 베이지안 로지스틱 회귀 분석은 매개변수 자체에 대한 사후 분포를 추정합니다. 사후 모델을 사용하면 모델의 불확실성에 대한 투명성이 높아지는 이점을 통해 각 매개변수에 대한 베이지안 신뢰 구간을 더욱 강력하게 추정할 수 있습니다.

[pymc3_workflow](02_pymc3_workflow.ipynb) 노트북은 다음을 포함하는 PYMC3 워크플로를 보여줍니다.
- MAP 추론
- 마르코프 체인 몬테카를로 추정 
    - 메트로폴리스-헤이스팅스
    - NUTS 샘플러
- 변이추론
- 모델 진단
    - 에너지 및 산림 부지
    - 후방 예측 검사(PPD) 및 
    - 신뢰구간(CI)
- 예측
- MCMC 샘플러 애니메이션
    
## 딜을 제공하는 베이안 ML

이제 ML에 대한 베이지안 접근 방식과 PyMC3를 사용한 확률적 프로그래밍에 익숙해졌으므로 몇 가지 관련 거래 관련 애플리케이션을 살펴보겠습니다. 
- 보다 통찰력 있는 성과 비교를 위해 샤프 비율을 확률 모델로 모델링합니다.
- 베이지안 선형 회귀를 사용하여 쌍 거래 헤지 비율 계산
- 베이지안 관점에서 선형 시계열 모델 분석

### 코드 예: 성능 비교를 위한 베이지안 샤프 비율

노트북 [베이지안_샤프_비율](03_bayesian_sharpe_ratio.ipynb)은 PyMC3를 사용하여 샤프 비율(SR)을 확률 모델로 정의하는 방법과 다양한 수익률 계열에 대한 사후 분포를 비교하는 방법을 보여줍니다.

두 계열에 대한 베이지안 추정은 효과 크기, 그룹 SR 평균 및 그 차이, 표준 편차 및 그 차이에 대한 신뢰할 수 있는 값의 완전한 분포를 제공하기 때문에 매우 풍부한 통찰력을 제공합니다. Python 구현은 Thomas Wiecki에 의해 이루어졌으며 R 패키지 BEST(Meredith 및 Kruschke 2018)에서 영감을 받았습니다. 아래 '리소스'를 참조하세요.

베이지안 SR의 관련 사용 사례에는 대체 전략 간의 차이 분석 또는 표본 외 수익 대비 전략의 표본 내 수익 간의 차이 분석이 포함됩니다(자세한 내용은 bayesian_sharpe_ratio 노트북 참조). 베이지안 샤프 비율은 또한 pyfolio의 베이지안 테어시트의 일부입니다.

### 코드 예: 쌍 거래에 대한 베이지안 롤링 회귀

지난 [장](../09_time_series_models)에서는 두 개 이상의 자산의 **공통 통합**에 의존하는 인기 있는 거래 전략으로 쌍 거래를 도입했습니다. 이러한 자산을 고려할 때, 롱 포지션과 숏 포지션의 상대적 규모를 결정하기 위해서는 헤징 비율을 추정해야 합니다. 기본 접근 방식은 선형 회귀를 사용합니다.

[롤링_회귀](04_rolling_regression.ipynb) 노트북은 베이지안 선형 회귀가 시간 경과에 따른 두 자산 간의 관계 변화를 추적하는 방법을 보여줍니다. 이는 Thomas Wiecki의 예를 따릅니다(아래 '리소스' 참조).

### 코드 예: 확률적 변동성 모델

[시계열 모델](../09_time_series_models) 장에서 논의한 것처럼 자산 가격은 시간에 따라 변동하는 변동성을 갖습니다. 어떤 기간에는 수익률이 매우 변동적이지만 다른 기간에는 매우 안정적입니다.

확률론적 변동성 모델은 확률론적 프로세스로 모델링된 잠재 변동성 변수를 사용하여 이를 모델링합니다. No-U-Turn Sampler는 이러한 모델을 사용하여 도입되었으며 노트북 [확률론적 변동성](05_stochastic_volatility.ipynb)은 이 사용 사례를 보여줍니다.

## 자원

### PyMC3

Quantopian에서 데이터 과학을 이끌고 있는 주요 PyMC3 작성자 중 한 명인 Thomas Wiecki는 다음 섹션에서 따르고 구축할 몇 가지 예제를 만들었습니다. PyMC3 문서에는 많은 추가 튜토리얼이 있습니다.

- PyMC3 [튜토리얼](https://docs.pymc.io/nb_tutorials/index.html)
- [Naive Bayes 텍스트 분류기의 잘못된 가정 다루기](http://people.csail.mit.edu/jrennie/papers/icml03-nb.pdf), Rennie 외, MIT SAIL, 2003
- [차별적 분류와 생성적 분류에 관하여: 로지스틱 회귀와 나이브 베이즈의 비교](https://ai.stanford.edu/~ang/papers/nips01-discriminativegenerative.pdf), 요르단, Ng, 2002
- [베이지안 추정이 t 검정을 대체합니다.](http://www.indiana.edu/~kruschke/BEST/BEST.pdf), John K. Kruschke, 실험 심리학 저널, 2012
- __자리표시자_52__

### 대체 확률 프로그래밍 라이브러리
- [확률적 프로그래밍](http://www.probabilistic-programming.org/wiki/Home) Community Repository with links to papers and software
- [스탠](https://mc-stan.org/)
- [에드워드](http://edwardlib.org/)
- [TensorFlow 확률](https://github.com/tensorflow/probability)
- [파이로](http://pyro.ai/)

