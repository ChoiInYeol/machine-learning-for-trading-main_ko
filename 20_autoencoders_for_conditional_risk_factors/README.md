# 조건부 위험 요소 및 자산 가격을 위한 자동 인코더

이 장에서는 비지도 학습이 거래에 딥 러닝을 어떻게 활용할 수 있는지 보여줍니다. 보다 구체적으로 수십 년 동안 사용되어 왔지만 최근에 새로운 관심을 불러일으킨 자동 인코더에 대해 논의하겠습니다.

오토인코더는 숨겨진 레이어의 매개변수로 인코딩된 데이터의 새로운 표현을 학습하면서 입력을 재현하도록 훈련된 신경망입니다. 
자동 인코더는 오랫동안 비선형 차원 축소 및 다양체 학습에 사용되어 왔습니다([제13장](../13_unsupervised_learning) 참조). 
다양한 디자인은 지난 세 장에서 다룬 피드포워드, 컨벌루션 및 순환 네트워크 아키텍처를 활용합니다.

또한 오토인코더가 [위험 요인을 추출하는 오토인코더](https://www.aqr.com/Insights/Research/Working-Paper/Autoencoder-Asset-Pricing-Models)을 사용하고 다양한 주식 속성을 조건으로 주식 수익을 예측하는 심층 신경망을 구축하여 거래 전략을 뒷받침할 수 있는 방법도 살펴보겠습니다(Gu, Kelly, and Xiu 2020).

## 콘텐츠

1. __자리표시자_2__
    * __자리표시자_3__
    * __자리표시자_4__
    * __자리표시자_5__
    * __자리표시자_6__
2. __자리표시자_7__
    * __자리표시자_8__
    * __자리표시자_9__
    * __자리표시자_10__
    * __자리표시자_11__

## 비선형 특징 추출을 위한 오토인코더

17장, [거래를 위한 딥러닝](../17_deep_learning)에서는 신경망이 주어진 작업에 유용한 계층적 특징 표현을 추출하여 지도 학습에서 어떻게 성공하는지 살펴보았습니다. 컨벌루션 신경망은 예를 들어 그리드형 데이터에서 점점 더 복잡해지는 패턴을 학습하고 합성하여 이미지의 개체를 식별 또는 감지하거나 시계열을 분류합니다. 
이와 대조적으로 오토인코더는 다른 작업을 해결하는 데 도움이 되는 방식으로 입력을 인코딩하는 새로운 표현을 학습하도록 독점적으로 설계된 신경망입니다. 이를 위해 훈련은 네트워크가 입력을 재현하도록 강제합니다. 오토인코더는 일반적으로 입력 및 출력과 동일한 데이터를 사용하므로 자기 지도 학습의 인스턴스로도 간주됩니다. 
이 과정에서 숨겨진 레이어 h의 매개변수는 [제16장](../16_word_embeddings)에서 다루는 word2vec 모델과 유사하게 입력을 나타내는 코드가 됩니다.

좋은 개요를 보려면 딥러닝의 14장을 참조하세요.
- [오토인코더](http://www.deeplearningbook.org/contents/autoencoders.html), Ian Goodfellow, Yoshua Bengio 및 Aaron Courville, 딥 러닝 북, MIT Press 2016

TensorFlow의 Keras 인터페이스를 사용하면 다양한 유형의 자동 인코더를 구축하는 것이 매우 간단하며 다음 예는 Keras의 튜토리얼에서 채택되었습니다.

- __자리표시자_15__

### 코드 예: 비선형 차원 축소를 사용한 PCA 일반화

전통적인 사용 사례에는 손실 압축을 수행하도록 숨겨진 레이어의 크기를 제한하여 달성되는 차원 축소가 포함됩니다. 이러한 오토인코더를 불완전하다고 부르며, 그 목적은 손실 함수를 최소화하여 데이터의 가장 두드러진 속성을 학습하도록 하는 것입니다. 피드포워드 아키텍처 외에도 오토인코더는 컨벌루션 레이어를 사용하여 계층적 특징 표현을 학습할 수도 있습니다.

The notebook [deep_autoencoders](01_deep_autoencoders.ipynb) illustrates how to implement several of autoencoder models using TensorFlow, including autoencoders using deep feedforward nets and sparsity constraints. 
 
### 코드 예: 이미지를 압축하고 노이즈를 제거하는 컨벌루션 자동 인코더

18장, [CNN: 이미지 및 위성 이미지 분류로서의 시계열](../18_convolutional_neural_nets)에서 설명한 것처럼 완전 연결 피드포워드 아키텍처는 그리드와 같은 구조의 데이터에 일반적인 로컬 상관 관계를 캡처하는 데 적합하지 않습니다. 대신, 오토인코더는 컨벌루션 레이어를 사용하여 계층적 특징 표현을 학습할 수도 있습니다. 컨볼루셔널 오토인코더는 컨볼루션과 매개변수 공유를 활용하여 위치, 변환 또는 크기 변화에 관계없이 계층적 패턴과 기능을 학습합니다.

노트북 [convolutional_denoising_autoencoders](02_convolutional_denoising_autoencoders.ipynb)에서는 손상된 이미지 입력을 복구하기 위해 컨벌루션 및 노이즈 제거 자동 인코더를 구현하는 방법을 계속 보여줍니다.

### 거래를 위한 시계열 특징을 추출하는 Seq2seq 자동 인코더

시퀀스-시퀀스 자동 인코더는 LSTM(Long Short-Term Memory) 또는 GRU(Gated Recurrent Unit)와 같은 RNN 구성 요소를 기반으로 합니다. 순차 데이터의 압축된 표현을 학습하고 비디오, 텍스트, 오디오 및 시계열 데이터에 적용되었습니다.

- [Keras의 시퀀스 간 학습에 대한 10분 소개](https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html), Francois Chollet, 2017년 9월
- [LSTM을 사용한 비디오 표현의 비지도 학습](https://arxiv.org/abs/1502.04681), Nitish Srivastava, Elman Mansimov, Ruslan Salakhutdinov, 2016
- __자리표시자_21__
    - __자리표시자_22__
- __자리표시자_23__
    - 동기 부여: 규제 기관은 질서 있는 시장에 해를 끼치는 금지된 거래 활동 패턴을 식별합니다. 금융거래소는 시장의 질서유지를 담당합니다. (예: Flash Crash 및 Hound of Hounslow.)
    - 과제: 금지된 거래 패턴을 빠르고 효율적으로 식별합니다.
    - **목표**: 딥러닝을 활용한 매매패턴 검색 기능을 구축합니다. 샘플 거래 패턴이 주어지면 과거 LOB 데이터에서 유사한 패턴을 식별합니다.

### 코드 예: 변형 자동 인코더 - 입력 데이터 생성 방법 학습

VAE(Variational Autoencoders)는 생성 모델링에 초점을 맞춘 최신 개발입니다. 보다 구체적으로 VAE는 입력 데이터에 대한 잠재 변수 모델을 학습하도록 설계되었습니다. 14장 주제 모델링에서 잠재 변수를 만났습니다.

따라서 VAE는 입력을 충실하게 재현하는 한 네트워크가 임의의 기능을 학습하도록 허용하지 않습니다. 대신 입력 데이터를 생성하는 확률 분포의 매개변수를 학습하는 것을 목표로 합니다. 즉, VAE는 생성 모델입니다. 성공할 경우 VAE에서 학습한 분포에서 샘플링하여 새로운 데이터 포인트를 생성할 수 있기 때문입니다.

[Variational_autoencoder](03_variational_autoencoder.ipynb) 노트북은 Keras를 사용하여 Variational Autoencoder를 빌드하는 방법을 보여줍니다.

- [자동 인코딩 변형 베이](https://arxiv.org/abs/1312.6114), Diederik P Kingma, 맥스 웰링, 2014
- __자리표시자_26__
- __자리표시자_27__

## 코드 예: 수익률 예측 및 거래를 위한 조건부 자동 인코더

[구, 켈리, 슈](https://www.aqr.com/Insights/Research/Working-Paper/Autoencoder-Asset-Pricing-Models)의 최근 연구에서는 위험 요소에 대한 증권 노출을 기반으로 자산 가격 책정 모델을 개발했습니다. 이는 PCA를 소개할 때 13장에서 논의한 데이터 기반 위험 요소의 개념과 4장 금융 특성 엔지니어링: 알파 요소를 조사하는 방법에서 다룬 위험 요소 모델을 기반으로 합니다. 
저자는 '이상 현상'의 체계적인 동인을 포착하기 위해 요인 모델에서 사용하는 자산 특성이 직접 측정할 수 없는 위험 요인에 대한 시간에 따라 변하는 노출에 대한 프록시일 뿐이라는 것을 보여주는 것을 목표로 합니다. 
이러한 맥락에서 이상 현상은 총 시장 위험에 대한 노출로 설명되는 수익을 초과하는 수익입니다([제5장](../05_strategy_evaluation)의 자본 자산 가격 책정 모델에 대한 논의 참조).

### 주가 및 메타데이터 정보가 포함된 새 데이터세트 만들기

참조 구현에서는 1957년부터 2016년까지 증권 가격 연구 센터(CRSP)에서 월별 빈도로 30,000개 이상의 미국 주식에 대한 주가 및 기업 특성 데이터를 사용합니다. 이는 이전 학술 연구에서 수익 예측으로 제안되고 이러한 주장을 검증하기 시작한 Green, Hand 및 Zhang(2017)에 나열된 광범위한 자산 속성을 포함하는 94개의 측정항목을 계산합니다.
고품질이지만 비용이 많이 드는 CRSP 데이터에 액세스할 수 없기 때문에 [금융](https://github.com/ranaroussi/yfinance)(2장 [시장 및 기본 데이터: 출처 및 기술](../02_market_and_fundamental_data) 참조)을 활용하여 Yahoo Finance에서 가격과 메타데이터를 다운로드합니다. 무료 데이터를 선택하면 다음과 같은 단점이 있습니다.
- 조정에 관한 품질 관리가 부족합니다. 
- 더 이상 상장되지 않은 주식에 대한 데이터를 얻을 수 없기 때문에 생존 편향
- 주식 수와 역사 기간 측면에서 범위가 더 작습니다.

노트북 [build_us_stock_dataset](04_build_us_stock_dataset.ipynb)에는 이 섹션과 관련된 코드 예제가 포함되어 있습니다.

### 예측 자산 특성 계산

저자는 94개의 자산 속성을 테스트하고 가장 영향력 있는 20개의 지표를 식별하는 동시에 기능 중요도가 그 이후 빠르게 떨어진다고 주장합니다. 상위 20개 주식 특성은 세 가지 범주로 분류됩니다.
- (산업) 모멘텀, 단기 및 장기 반전, 최근 최대 수익률 등 가격 추세
- 매출액, 달러 규모, 시가총액 등의 유동성
- 위험 측정(예: 전체 및 특이한 수익률 변동성 또는 시장 베타)

이 20개 중 관련 입력을 가지고 있거나 근사화할 수 있는 16개로 분석을 제한합니다. [조건부_자동인코더_for_trading_data](05_conditional_autoencoder_for_trading_data.ipynb) 노트북은 관련 측정항목을 계산하는 방법을 보여줍니다.

### 조건부 오토인코더 아키텍처 생성 및 학습

저자가 제안한 조건부 오토인코더는 변화하는 자산 특성을 고려하여 시간에 따라 변하는 수익 분포를 허용합니다. 
이를 위해 이 장의 첫 번째 섹션에서 논의한 표준 오토인코더 아키텍처를 확장하여 인코딩을 형성하는 기능을 허용합니다.

[Conditional_autoencoder_for_asset_pricing_model](06_conditional_autoencoder_for_asset_pricing_model.ipynb) 노트북은 이 아키텍처를 생성하고 학습하는 방법을 보여줍니다.

### 결과 평가

[알파렌즈_분석](07_alphalens_analysis.ipynb) 노트북은 모델 예측의 재무 성과를 측정합니다.

