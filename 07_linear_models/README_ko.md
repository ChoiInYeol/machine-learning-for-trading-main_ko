# 선형 모델: 위험 요인부터 자산 수익률 예측까지

선형 모델 계열은 가장 유용한 가설 클래스 중 하나를 나타냅니다. 알고리즘 거래에 널리 적용되는 많은 학습 알고리즘은 효율적으로 훈련할 수 있고 시끄러운 금융 데이터에 상대적으로 강력하며 금융 이론과 강력한 연관성을 갖고 있기 때문에 선형 예측 변수에 의존합니다. 선형 예측 변수는 또한 직관적이고 해석하기 쉬우며 종종 데이터를 합리적으로 잘 맞추거나 적어도 좋은 기준선을 제공합니다.

선형 회귀는 Legendre와 Gauss가 이를 천문학에 적용하고 통계적 특성을 분석하기 시작한 이래로 200년 넘게 알려져 왔습니다. 이후 수많은 확장 프로그램에서 선형 회귀 모델과 기본 OLS(보통 최소 제곱법) 방법을 적용하여 해당 매개변수를 학습했습니다.

- **일반화 선형 모델**(GLM)은 정규 분포가 아닌 오류 분포를 암시하는 응답 변수를 허용하여 적용 범위를 확장합니다. GLM에는 분류 문제에 나타나는 범주형 반응 변수에 대한 프로빗 또는 로지스틱 모델이 포함됩니다.
- 보다 **강력한 추정 방법**을 사용하면 시간 경과에 따른 상관 관계나 관측치에 따른 상관 관계 등으로 인해 데이터가 기본 가정을 위반하는 경우 통계적 추론이 가능해집니다. 이는 자산 전체에 대한 과거 수익률과 같은 동일한 단위에 대한 반복적인 관찰을 포함하는 패널 데이터의 경우에 종종 해당됩니다.
- **수축 방법**은 선형 모델의 예측 성능을 향상시키는 것을 목표로 합니다. 그들은 모델의 분산을 줄이고 샘플 외 예측 성능을 향상시키기 위해 모델에서 학습한 계수를 편향시키는 복잡성 페널티를 사용합니다.

실제로 선형 모델은 추론과 예측을 목표로 회귀 및 분류 문제에 적용됩니다. 선형 회귀를 활용하는 수많은 자산 가격 책정 모델이 학계 및 업계 연구자에 의해 개발되었습니다. 응용 프로그램에는 더 나은 위험 및 성과 관리를 위해 자산 수익을 유도하는 중요한 요소의 식별뿐만 아니라 다양한 기간에 대한 수익 예측이 포함됩니다. 반면 분류 문제에는 방향성 가격 예측이 포함됩니다. 이 장에서는 다음 주제를 다룰 것입니다:

## 콘텐츠

1. __자리표시자_0__
2. __자리표시자_1__
    * __자리표시자_2__
3. __자리표시자_3__
    * __자리표시자_4__
    * __자리표시자_5__
    * __자리표시자_6__
4. __자리표시자_7__
    * __자리표시자_8__
    * __자리표시자_9__
    * __자리표시자_10__
5. __자리표시자_11__
    * __자리표시자_12__
6. __자리표시자_13__
    * __자리표시자_14__
    * __자리표시자_15__
    * __자리표시자_16__
7. __자리표시자_17__

## 선형 회귀: 추론에서 예측까지

이 섹션에서는 선형 모델을 위한 기본 단면 및 패널 기술과 주요 가정이 위반될 때 정확한 추정치를 생성하는 중요한 개선 사항을 소개합니다. 알고리즘 거래 전략 개발에 널리 사용되는 요인 모델을 추정하여 이러한 방법을 계속 설명합니다. 마지막으로 정규화 방법에 중점을 둡니다.

- [계량경제학 입문](http://economics.ut.ac.ir/documents/3030266/14100645/Jeffrey_M._Wooldridge_Introductory_Econometrics_A_Modern_Approach__2012.pdf), 울드리지, 2012

## 기본 모델: 다중 선형 회귀

이 섹션에서는 모델의 사양과 목적 함수, 해당 매개변수를 학습하는 방법, 이러한 가정의 추론과 진단을 허용하는 통계적 가정, 그리고 이러한 가정이 실패하는 상황에 모델을 적용하기 위한 확장을 소개합니다. 내용은 다음과 같습니다:

- 모델을 공식화하고 훈련시키는 방법
- 가우스-마르코프 정리
- 통계적 추론을 수행하는 방법
- 문제를 진단하고 해결하는 방법
- 실제로 선형 회귀를 실행하는 방법

### 코드 예: `statsmodels` 및 `scikit-learn`을 사용한 단순 및 다중 선형 회귀

노트북 [선형_회귀_소개](01_linear_regression_intro.ipynb)은 단순 다중 선형 회귀 모델을 보여 주며, 후자는 `statsmodels` 및 `scikit-learn`을 기반으로 OLS와 경사하강법을 모두 사용합니다.

## 선형 요인 모델을 구축하는 방법

알고리즘 거래 전략은 선형 요인 모델을 사용하여 자산 수익과 이러한 수익의 주요 동인을 나타내는 위험 소스 간의 관계를 정량화합니다. 각 요소 위험에는 프리미엄이 수반되며 총 자산 수익률은 이러한 위험 프리미엄의 가중 평균에 해당할 것으로 예상할 수 있습니다.

### CAPM에서 Fama까지 - 프랑스 5요인 모델

CAPM(Capital Asset Pricing Model)이 단일 요소에 대한 각각의 노출, 즉 무위험 금리에 대한 전체 시장의 예상 초과 수익을 사용하여 모든 자산의 기대 수익을 설명한 이후 위험 요소는 정량적 모델의 핵심 요소였습니다.

이는 수익이 기업 특성에 따라 달라지는 Dodd 및 Graham의 고전적인 기본 분석과 다릅니다. 그 근거는 전체적으로 투자자들이 다각화를 통해 이러한 소위 체계적 위험을 제거할 수 없다는 것입니다. 따라서 균형에서는 체계적 위험에 상응하는 자산 보유에 대한 보상이 필요합니다. 이 모델은 가격이 모든 공개 정보를 즉시 반영하는 효율적인 시장에서는 더 나은 위험 조정 수익률이 없어야 함을 의미합니다.

### 위험 요소 획득

[파마—프랑스 위험 요인](http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html)은 주어진 위험 요소를 반영하는 지표에 따라 높거나 낮은 값을 갖는 다양한 포트폴리오의 수익률 차이로 계산됩니다. 이러한 수익률은 이러한 지표에 따라 주식을 분류한 다음 특정 백분위수 이상의 주식을 매수하고 특정 백분위수 미만의 주식을 매도함으로써 얻을 수 있습니다. 위험 요소와 관련된 지표는 다음과 같이 정의됩니다.

- 규모 : 시장자본(ME) 
- 가치: 자기자본의 장부가치(BE)를 ME로 나눈 값
- 영업이익률(OP): 매출에서 매출원가/자산을 뺀 금액
- 투자: 투자/자산

Fama와 French는 [웹사이트]((http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html))를 통해 업데이트된 위험 요소 및 연구 포트폴리오 데이터를 제공하며, [pandas_datareader](https://pandas-datareader.readthedocs.io/en/latest/) 라이브러리를 사용하여 데이터를 얻을 수 있습니다.

### 코드 예: Fama - 맥베스 회귀

잔차의 상관관계로 인해 발생하는 추론 문제를 해결하기 위해 Fama와 MacBeth는 요인 수익의 단면 회귀를 위한 2단계 방법을 제안했습니다. 2단계 Fama—Macbeth 회귀 분석은 시장의 특정 위험 요인에 대한 노출에 대해 보상되는 프리미엄을 추정하도록 설계되었습니다. 두 단계는 다음과 같이 구성됩니다.
- **첫 번째 단계**: 팩터 로딩을 추정하기 위해 팩터에 대한 초과 수익에 대해 각 자산 또는 포트폴리오에 대해 하나씩 N개의 시계열 회귀를 수행합니다.
- **두 번째 단계**: 위험 프리미엄을 추정하기 위해 각 기간에 대해 하나씩 T 단면 회귀를 수행합니다.

노트북 [fama_macbeth](02_fama_macbeth.ipynb)은 [선형모델](https://bashtage.github.io/linearmodels/doc/) 라이브러리 사용을 포함하여 Fama-Macbeth 회귀를 실행하는 방법을 보여줍니다.

## 축소 방법: 선형 회귀를 위한 정규화

선형 회귀 모델에 상관 변수가 많이 포함되어 있으면 RSS에 대한 큰 양수 계수의 효과가 상관 변수에 대한 비슷하게 큰 음수 계수에 의해 상쇄될 수 있기 때문에 계수가 제대로 결정되지 않습니다. 따라서 모델이 표본에 과적합될 위험을 증가시키는 계수의 흔들림 공간으로 인해 모델의 분산이 높아지는 경향이 있습니다.

### 과적합 방지 – 선형 모델의 정규화

과적합을 제어하는 ​​인기 있는 기술 중 하나는 계수가 큰 값에 도달하는 것을 방지하기 위해 오류 함수에 페널티 항을 추가하는 정규화 기술입니다. 즉, 계수의 크기 제약은 표본 외 예측에 대한 잠재적인 부정적인 영향을 완화할 수 있습니다. 과적합은 널리 퍼져 있는 문제이므로 모든 모델에 대한 정규화 방법을 접하게 됩니다.

이 섹션에서는 지금까지 논의된 선형 모델에 대한 접근 방식을 개선하기 위한 두 가지 동기를 해결하는 수축 방법을 소개합니다.
- 예측 정확도: 최소 제곱 추정치의 편향은 낮지만 분산은 높으므로 일부 계수를 축소하거나 0으로 설정하여 모델의 분산을 줄이기 위해 약간 더 높은 편향을 절충함으로써 일반화 오류를 줄일 수 있음을 시사합니다.
- 해석: 예측 변수가 너무 많으면 결과의 큰 그림을 해석하거나 전달하는 것이 복잡해질 수 있습니다. 모델을 가장 강력한 효과를 갖는 더 작은 매개변수 하위 집합으로 제한하기 위해 일부 세부 사항을 희생하는 것이 바람직할 수 있습니다.

### 능선 회귀

리지 회귀는 계수 벡터의 L2 노름에 해당하는 제곱 계수의 합과 같은 목적 함수에 페널티를 추가하여 회귀 계수를 축소합니다.

### 올가미 회귀

신호 처리에서 기저 추적으로 알려진 올가미(lasso)도 잔차의 제곱합에 페널티를 추가하여 계수를 축소하지만 올가미 페널티는 약간 다른 효과를 갖습니다. 올가미 페널티는 L1 노름에 해당하는 계수 벡터의 절대값의 합입니다.

## 선형 회귀를 사용하여 주식 수익률을 예측하는 방법

이 섹션에서는 축소가 있거나 없는 선형 회귀를 사용하여 수익을 예측하고 거래 신호를 생성합니다. 이를 위해 먼저 데이터 세트를 만든 다음 이전 섹션에서 설명한 선형 회귀 모델을 적용하여 statsmodels 및 sklearn의 사용법을 설명합니다.

### 코드 예제: 주식 수익률 추론 및 예측

- [준비_the_model_data](03_preparing_the_model_data.ipynb) 노트북은 미국 주식 세계를 선택하고 일일 수익률을 예측하는 여러 기능을 생성합니다.
- 노트북 [Statistics_inference_of_stock_returns_with_statsmodels](04_statistical_inference_of_stock_returns_with_statsmodels.ipynb)은 OLS 및 `statsmodels` 라이브러리를 사용하여 여러 선형 회귀 모델을 추정합니다.
- 노트북 [예측_주식_반환_with_선형_회귀](05_predicting_stock_returns_with_linear_regression.ipynb)에서는 선형 회귀 분석을 사용하여 일일 주식 수익률을 예측하는 방법과 `scikit-klearn`을 사용한 능선 및 올가미 모델을 보여줍니다.
- 노트북 [평가_신호_사용_알파렌즈](06_evaluating_signals_using_alphalens.ipynb)은 `alphalens`을 사용하여 모델 예측을 평가합니다.

## 선형 분류

정성적 반응을 예측하는 데는 다양한 분류 기술이 있습니다. 이번 장에서는 선형회귀와 밀접하게 연관되어 널리 사용되는 로지스틱 회귀를 소개한다. 다음 장에서는 의사결정 트리, 랜덤 포레스트, 그래디언트 부스팅 머신 및 신경망을 포함하는 일반화된 추가 모델에 대해 더 복잡한 방법을 다룰 것입니다.

### 로지스틱 회귀 모델

로지스틱 회귀 모델은 선형 회귀 모델과 마찬가지로 x에서 선형인 함수가 주어지면 출력 클래스의 확률을 모델링하는 동시에 그 합이 1로 유지되고 [0, 1] 우리가 확률에서 기대하는 것과 같습니다.

본 절에서는 로지스틱 회귀 모델의 객관적이고 기능적인 형태를 소개하고 훈련 방법을 설명합니다. 그런 다음 통계 모델을 사용하여 거시 데이터에 대한 통계적 추론을 위해 로지스틱 회귀를 사용하는 방법과 sklearn에서 구현한 정규화된 로지스틱 회귀를 사용하여 가격 변동을 예측하는 방법을 설명합니다.

### 코드 예: 통계 모델을 사용하여 추론을 수행하는 방법

[logistic_regression_macro_data](07_logistic_regression_macro_data.ipynb)` 노트북은 매크로 데이터에 대해 로지스틱 회귀를 실행하고 [상태 모델](https://www.statsmodels.org/stable/index.html)을 사용하여 통계적 추론을 수행하는 방법을 보여줍니다.

### 코드 예제: 예측에 로지스틱 회귀를 사용하는 방법

Lasso L1 페널티와 Ridge L2 페널티는 모두 로지스틱 회귀 분석에 사용될 수 있습니다. 방금 논의한 것과 동일한 축소 효과가 있으며 선형 회귀 모델에서 변수 선택에 올가미를 다시 사용할 수 있습니다.

선형 회귀와 마찬가지로 정규화된 모델은 규모에 민감하므로 입력 변수를 표준화하는 것이 중요합니다. 정규화 하이퍼파라미터에는 선형 회귀 사례와 마찬가지로 교차 검증을 사용한 조정도 필요합니다.

[예측_가격_이동_with_로지스틱_회귀](08_predicting_price_movements_with_logistic_regression.ipynb) 노트북은 주가 변동 예측을 위해 로지스틱 회귀를 사용하는 방법을 보여줍니다.

## 참고자료

- [위험, 수익 및 균형: 실증적 테스트](https://www.jstor.org/stable/1831028), Eugene F. Fama 및 James D. MacBeth, Journal of Political Economy, 81(1973), pp. 607–636
- [자산 가격](http://faculty.chicagobooth.edu/john.cochrane/teaching/asset_pricing.htm), 존 코크레인, 2001